# 회귀분석 06 - 일반화선형모형 I 이론

---

## 목차

**I. 일반화선형모형의 기초**
1. [일반화선형모형(GLM)의 기본 개념](#1-일반화선형모형glm의-구성요소)
2. [선형회귀모형의 한계점](#2-선형회귀모형의-한계점)
3. [일반화선형모형의 필요성](#3-일반화선형모형의-필요성)

**II. 일반화선형모형의 구성요소**
1. [확률분포와 지수분포군](#4-확률분포와-지수분포군)
2. [연결함수(Link Function)](#5-연결함수link-function)
3. [선형 예측자](#6-선형-예측자)

**III. 일반화선형모형의 추정과 평가**
1. [최대우도 추정법](#7-최대우도-추정법)
2. [편차 잔차와 적합도 평가](#8-편차-잔차와-적합도-평가)
3. [분산분석과 유의성 검정](#9-분산분석과-유의성-검정)

---

## I. 일반화선형모형의 기초

### 1. 일반화선형모형(GLM)의 기본 개념

### 2. 선형회귀모형의 한계점

- **선형회귀모형의 예**: $Y_i = \beta_0 + \beta_1 X_{i1} + \beta_2 X_{i2} + \epsilon_i$, $\epsilon_i \sim iid N(0, \sigma^2)$
    - $Y_i$의 확률분포는 정규분포를 따릅니다. $Y_i \sim N(\beta_0 + \beta_1 X_{i1} + \beta_2 X_{i2}, \sigma^2)$
- **선형회귀모형의 주요 가정**:
    1. **오차의 정규분포 가정**: 이는 등분산성 가정(오차의 분산이 평균과 무관)을 내포합니다.
    2. **모형의 선형성 가정**: 설명변수와 반응변수의 평균($E(Y_i)$)은 선형 함수 관계를 가집니다.
- **선형회귀모형의 한계와 극복 방안**:
    - **오차의 등분산성 위배 시**: 분산안정화 변환(예: 로그 변환, 제곱근 변환)을 시도합니다.
    - **한계**: 분산안정화 변환 후에도 여전히 정규분포 가정에 대한 타당성 문제가 남아있을 수 있습니다.

### 3. 일반화선형모형의 필요성

- **반응변수가 이분형 또는 비율인 경우**:
    - **예**: 특정 질환 발생 여부 (0 또는 1), 날다람쥐 출현 여부 (0 또는 1).
    - **가능한 확률분포 가정**: 베르누이 분포, 이항분포.
    - **적용 가능한 회귀모형**: 로지스틱 회귀모형, 프로빗 모형 등.
- **반응변수가 개수형(Count Data)인 경우**:
    - **예**: 하루 동안 교통사고 사망자 수, 특정 감염 질환자 일일 발병 건수.
    - **가능한 확률분포 가정**: 포아송 분포, 음이항 분포.
    - **적용 가능한 회귀모형**: 로그선형 모형 등.
- **반응변수가 양의 값을 가지는 연속형인 경우 (정규분포 가정이 부적절할 때)**:
    - **예**: 가계소득, 헤모글로빈 수치 (분포가 오른쪽으로 치우친 경우).
    - **가능한 확률분포 가정**: 감마 분포, 로그정규 분포.
    - **적용 가능한 회귀모형**: (일반) 로그선형모형 등.
- **기존 접근 방식**: 각 회귀모형들이 적용 분야에 따라 독립적으로 개발되어 사용되었습니다.

## II. 일반화선형모형의 구성요소

### 4. 확률분포와 지수분포군

- **정의 (Nelder & Wedderburn, 1972)**:
    - 반응변수의 확률분포가 정규분포, 이항분포, 포아송분포, 감마분포, 음이항분포, 역정규분포 등과 같은 **지수족(Exponential Family) 분포** 중 하나를 따른다고 가정할 때, 이를 분석하는 회귀모형을 하나의 모형설정 틀에서 **통합적으로 설정하는 모형**입니다.
    - 선형회귀모형의 **확장된 형태**입니다.
- **선형회귀모형에서 GLM으로의 확장**:
    
    
    | 구분 | 선형회귀모형 | 일반화선형모형 (GLM) |
    | --- | --- | --- |
    | **반응변수 분포** | 정규분포 가정 | 정규분포, 이항분포, 포아송분포, 음이항분포, 감마분포 등 **지수족 분포** 중 하나를 가정 |
    | **평균의 선형성** | $\mu = E(Y) = \mathbf{x}'\mathbf{\beta}$ | $\eta = g(\mu) = \mathbf{x}'\mathbf{\beta}$  ($g(\cdot)$는 연결함수) |
    | **모수 추정법** | 최소제곱추정 (OLS) | **최대가능도추정 (Maximum Likelihood Estimation, MLE)** |
- **GLM 설정에 필요한 세 가지 구성성분**:
    1. **반응변수의 분포 (Random Component)**: 반응변수 $Y_i$의 확률분포 가정 (지수족 분포 중 하나).
    2. **선형예측자 (Systematic Component, $\eta$)**: 반응변수에 영향을 주는 설명변수들의 선형 결합. $\eta_i = \beta_0 + \beta_1 x_{i1} + \dots + \beta_p x_{ip} = \mathbf{x}_i'\mathbf{\beta}$.
    3. **연결함수 (Link Function, $g(\mu)$)**: 반응변수의 평균($\mu = E(Y_i)$)과 선형예측자($\eta_i$)를 연결하는 함수. $\eta_i = g(\mu_i)$.
        - $g(\cdot)$는 미분 가능하며 단조 증가하는 함수.
- **예제 자료: AIDS 사망자료 (Whyte, et al. 1987)**
    - $x$: 1983년 1월부터 시작한 3개월 단위 경과기간
    - $Y$: 사망자 수
    - **반응변수 $Y$의 분포**: 개수 데이터이므로 포아송 분포 등을 고려할 수 있음. (그래프 상으로는 기간이 지남에 따라 사망자 수가 증가하는 경향)
    - **선형예측자**: $\eta = \beta_0 + \beta_1 x$
    - **연결함수**: $Y$가 포아송 분포를 따른다면, 평균 $\mu = E(Y)$는 양수여야 하므로, $\mu$와 $\eta$를 연결하는 함수 $g(\mu)$를 고려해야 함. 예를 들어, 로그 연결함수 $g(\mu) = \log(\mu)$를 사용하면 $\log(\mu) = \beta_0 + \beta_1 x$가 됨.

### 5. 연결함수(Link Function)

### 6. 선형 예측자

- **① 반응변수의 분포 가정: 지수족 분포 (Exponential Family Distributions)**
    - 확률밀도(질량)함수가 다음과 같은 형태로 표현되는 분포:
    $f(y; \theta, \phi) = \exp\left\{\frac{y\theta - b(\theta)}{\phi/\omega} + c(y, \phi)\right\}$ (강의 자료와 약간 다른 표현, $q(y, \phi/\omega) = \exp\{c(y,\phi)\}$)
        - $\theta$: **정준모수 (Canonical Parameter)**
        - $\phi$: **산포모수 (Dispersion Parameter)**
        - $\omega$: 알려진 가중치 (상수값, 보통 1)
        - $b(\theta), c(y, \phi)$: 특정 함수
    - **평균과 분산, 분산함수**:
        - $E(Y) = \mu = b'(\theta)$ (정준모수 $\theta$에 대한 $b(\theta)$의 1차 미분)
        - $Var(Y) = \frac{\phi}{\omega} b''(\theta)$ (정준모수 $\theta$에 대한 $b(\theta)$의 2차 미분)
        - **분산함수 (Variance Function)**: $V(\mu) = b''(\theta)$. 분산이 평균 $\mu$의 함수로 표현될 때, 그 함수 형태. (예: 포아송 분포는 $V(\mu) = \mu$)
    - **지수족에 속하는 주요 확률분포**: 정규분포, 이항분포, 포아송분포, 감마분포, 음이항분포 등.
    - **예시**:
        - **정규분포 $Y \sim N(\mu, \sigma^2)$**: $\theta = \mu$, $b(\theta) = \theta^2/2$, $\phi = \sigma^2$, $\omega = 1$. $V(\mu) = 1$.
        - **이항분포 $Y \sim B(n, \pi)$**: $\theta = \log(\frac{\pi}{1-\pi})$ (로짓 변환), $b(\theta) = n \log(1+e^\theta)$, $\phi = 1$, $\omega = 1$. $E(Y) = n\pi$, $Var(Y) = n\pi(1-\pi)$. $V(\mu) = \pi(1-\pi)$ (n=1, 즉 베르누이 분포일 때).
        - **포아송분포 $Y \sim Poisson(\mu)$**: $\theta = \log(\mu)$, $b(\theta) = e^\theta$, $\phi = 1$, $\omega = 1$. $E(Y) = \mu$, $Var(Y) = \mu$. $V(\mu) = \mu$.
- **② 선형예측자 ($\eta$)**:
    - 설명변수들의 선형 결합: $\eta = \beta_0 + \beta_1 x_1 + \dots + \beta_p x_p$.
    - 모형에 포함될 설명변수들을 설정하는 단계.
    - **예제: 날다람쥐 출현 자료**:
        - $Y$: 날다람쥐 출현 여부 (1=yes, 0=no)
        - $x_1$: 구획의 크기, $x_2$: 구획의 연결성 정도
        - $\eta = \beta_0 + \beta_1 x_1 + \beta_2 x_2$
- **③ 연결함수 ($g(\mu)$)**:
    - 선형예측자 $\eta$와 반응변수의 평균 $\mu$를 연결: $\eta = g(\mu)$.
    - **연결함수 선택 기준**:
        1. **정의역 일치**: 연결함수 $g(\mu)$의 정의역이 반응변수 평균 $\mu$의 모수공간(parameter space)과 일치해야 함.
            - 항등함수 $g(\mu) = \mu \Rightarrow -\infty < \mu < \infty$ (정규분포 등)
            - 로짓함수 $g(\mu) = \log(\frac{\mu}{1-\mu}) \Rightarrow 0 < \mu < 1$ (이항분포, 베르누이분포 등 - $\mu$가 확률 $\pi$)
            - 로그함수 $g(\mu) = \log(\mu) \Rightarrow 0 < \mu < \infty$ (포아송분포, 감마분포 등 - $\mu$가 양수)
        2. **해석 용이성**: 설명변수의 영향을 해석하고 평가하는 데 용이해야 함.
        3. **정준연결 (Canonical Link)**: 지수족 분포에서 $\theta = g(\mu)$를 만족하는 연결함수. 수학적으로 다루기 편리하고, MLE 추정 알고리즘이 안정적인 경우가 많음.
            
            
            | 분포 | 평균 ($\mu$) | 정준모수 ($\theta$) | 정준연결 ($\eta = \theta$) | 연결함수 이름 |
            | --- | --- | --- | --- | --- |
            | 정규분포 | $\mu$ | $\mu$ | $\eta = \mu$ | 항등(identity) |
            | 이항분포 | $n\pi$ | $\log(\frac{\pi}{1-\pi})$ | $\eta = \log(\frac{\pi}{1-\pi})$ | 로짓(logit) |
            | 포아송분포 | $\mu$ | $\log(\mu)$ | $\eta = \log(\mu)$ | 로그(log) |
            | 감마분포 | $\mu$ | $-1/\mu$ | $\eta = -1/\mu$ (또는 $1/\mu$) | 역수(inverse) |

## III. 일반화선형모형의 추정과 평가

### 7. 최대우도 추정법

- **R의 `glm()` 함수를 이용한 GLM 설정**:
    - `glm(formula, family = distribution_family(link = "link_function"), data = data_frame)`
    - `family`: 반응변수의 분포와 연결함수를 지정.
        - `gaussian(link="identity")`: 정규분포, 항등연결 (선형회귀와 동일)
        - `binomial(link="logit")`: 이항/베르누이분포, 로짓연결 (로지스틱 회귀)
        - `poisson(link="log")`: 포아송분포, 로그연결 (로그선형모형)
        - `Gamma(link="inverse")`: 감마분포, 역수연결 등
- **날다람쥐 출현자료 예제**:
    - $Y$: 날다람쥐 출현여부 (occurr, 1=yes, 0=no)
    - $x_1$: 구획의 크기 (p_size_km)
    - $x_2$: 연결성 정도 (con_metric)
    - **로지스틱 회귀모형의 GLM 구성성분**:
        1. **반응변수 분포**: $Y \sim Bernoulli(\pi)$, 여기서 $\pi = E(Y) = P(Y=1)$ (출현 확률)
        2. **선형예측자**: $\eta = \beta_0 + \beta_1 x_1 + \beta_2 x_2$
        3. **연결함수**: 로짓함수 (이항분포의 정준연결) $\eta = g(\pi) = \log(\frac{\pi}{1-\pi})$
        - 모형식: $\log(\frac{\pi}{1-\pi}) = \beta_0 + \beta_1 x_1 + \beta_2 x_2$
- **모형 적합 및 결과 해석 (R 예시)**: (강의 자료 그림 참조)
    - **적합된 선형예측자**: $\hat{\eta} = \log(\frac{\hat{\pi}}{1-\hat{\pi}}) = \hat{\beta}_0 + \hat{\beta}_1 x_1 + \hat{\beta}_2 x_2 = -3.606 + 0.024x_1 + 1.632x_2$
    - **회귀계수 Wald 검정**: 각 계수가 0인지 검정 (z-value, Pr(>|z|)).
    - **산포모수 (Dispersion parameter)**: 이항분포와 포아송분포에서는 보통 1로 고정됨.
    - **이탈도 (Deviance)**:
        - **영(Null) 이탈도**: 절편만 있는 모형($\log(\frac{\pi}{1-\pi}) = \beta_0$)의 이탈도. (예: 68.994 on 49 DF)
        - **잔차 이탈도 (Residual Deviance)**: 현재 적합된 모형($\log(\frac{\pi}{1-\pi}) = \beta_0 + \beta_1 x_1 + \beta_2 x_2$)의 이탈도. (예: 54.661 on 47 DF)
            - 포화모형(saturated model) 대비 현재 모형의 적합도를 나타냄. 작을수록 좋음.
    - **AIC (Akaike Information Criterion)**: 모형 선택 기준. 작을수록 좋음.
- **로지스틱 회귀모형의 유의성 검정과 적합결여 검정**:
    - **모형의 유의성 검정 (Overall Model Significance)**:
        - $H_0: \log(\frac{\pi}{1-\pi}) = \beta_0$ (모든 기울기 계수가 0이다) vs $H_1: \log(\frac{\pi}{1-\pi}) = \beta_0 + \beta_1 x_1 + \beta_2 x_2$ (적어도 하나 이상의 기울기 계수가 0이 아니다)
        - **가능도비 검정 (Likelihood Ratio Test, LRT)**:
            - 검정통계량 $LR = \text{영 이탈도} - \text{잔차 이탈도}$
            - $H_0$ 하에서 $LR \sim \chi^2(df)$, 여기서 $df$는 두 모형의 모수 개수 차이 (현재 모형의 설명변수 개수).
            - 예시: $lr = 68.994 - 54.661 = 14.333$. $df=2$. p-값을 계산하여 유의성 판단.
    - **적합결여 검정 (Goodness-of-fit Test, Lack-of-fit Test)**:
        - $H_0: \text{현재 모형이 적절하다} (\log(\frac{\pi}{1-\pi}) = \beta_0 + \beta_1 x_1 + \beta_2 x_2)$ vs $H_1: \text{포화모형이 더 적절하다}$ (각 공변량 패턴마다 다른 확률을 갖는 모형)
        - **가능도비 검정**:
            - 검정통계량 $LR = \text{잔차 이탈도}$
            - $H_0$ 하에서 $LR \sim \chi^2(df)$, 여기서 $df$는 잔차의 자유도.
            - 예시: $lr = 54.661$. $df=47$. p-값을 계산하여 유의성 판단. (만약 p-값이 크면 현재 모형이 데이터에 잘 적합한다고 판단)

### 8. 편차 잔차와 적합도 평가

- 어떤 설명변수를 모형에 포함시킬지 결정하는 문제.
- **가설검정 이용**: 예) $H_0: \log(\frac{\pi}{1-\pi}) = \beta_0 + \beta_1 x_1$ vs $H_1: \log(\frac{\pi}{1-\pi}) = \beta_0 + \beta_1 x_1 + \beta_2 x_2$
    - $\beta_2$에 대한 Wald 검정 (z-test) 또는 가능도비 검정 등을 통해 변수 $x_2$의 유의성 판단.
- **AIC를 이용한 단계적 변수선택 (Stepwise Selection using AIC)**:
    - R의 `stepAIC()` 함수 (MASS 패키지) 등 사용 가능.
    - **양방향 선택법 (Both direction)**: 현재 모형에서 출발하여 변수를 하나씩 추가하거나 제거하면서 AIC 값이 가장 작은 모형을 최종적으로 선택.
    - 예시 (강의자료 그림):
        - 전체 모형 ($x_1, x_2$ 포함): AIC 값 제시.
        - $x_1$만 포함 모형: AIC 값 제시.
        - $x_2$만 포함 모형: AIC 값 제시.
        - 그림에서는 $x_1$만 포함한 모형 (`log(π/(1-π)) = β0 + β1x1`)이 AIC가 가장 작아 최종 선택됨.
        - 최종 선택된 모형: $\log(\frac{\hat{\pi}}{1-\hat{\pi}}) = -2.528 + 0.022x_1$

---
### 9. 분산분석과 유의성 검정

## IV. 이항자료와 로지스틱 회귀모형

### 10. 로지스틱 회귀모형의 기본 원리

- **로지스틱 함수의 특성**:
    - $Y$는 베르누이 확률변수 (0 또는 1), $\pi(x) = E(Y|x) = P(Y=1|x)$ (성공 확률)
    - **로짓 변환**: $\text{logit}(\pi(x)) = \log\left(\frac{\pi(x)}{1-\pi(x)}\right) = \beta_0 + \beta_1 x$
    - **로지스틱 함수 (역 로짓 변환)**: $\pi(x) = \frac{\exp(\beta_0 + \beta_1 x)}{1 + \exp(\beta_0 + \beta_1 x)}$
    - **특성**:
        1. $0 < \pi(x) < 1$ (모든 실수 $x, \beta_0, \beta_1$에 대해)
        2. $x$가 증가함에 따라 S자형 곡선 형태를 보임.
        3. $\beta_1 > 0$ 이면 단조 증가, $\beta_1 < 0$ 이면 단조 감소.
- **이항자료에 로지스틱 회귀모형을 적합시키는 의미**:
    - 설명변수 $x$의 변화에 따른 표본 성공 비율의 변화를 **S자형 곡선으로 적합**시키는 것.
    - (참고: 표 형식 이항자료의 분석 - 각 $x$값에 대해 여러 번의 시행과 성공 횟수가 주어지는 경우)
- **로지스틱 회귀모형의 해석 방법**:
    1. **선형근사적 해석 (미분 이용)**:
        - $x$ 값의 변화가 성공률 $\pi(x)$에 미치는 영향의 크기를 미분을 통해 파악.
        - $\pi'(x) = \frac{d\pi(x)}{dx} = \beta_1 \pi(x) [1 - \pi(x)]$
        - **순간 변화량**: $x$ 값, 즉 $\pi(x)$ 값에 따라 변화량의 크기가 달라짐.
            - $\pi(x) = 0.5$ (즉, 로짓값 $\beta_0 + \beta_1 x = 0$) 일 때, 순간 변화량은 $\beta_1/4$로 가장 큼.
        - 하나의 값으로 영향 크기를 제시하기 어려우므로 **평균 주변 효과(Average Marginal Effect, AME)**를 사용.
            - AME: 각 표본 $x_i$ 값에서 구한 $\pi(x_i)$의 순간 변화량들의 평균값.
        - **날다람쥐 출현 예제자료 (이전 강의 최종 모형: $\log(\frac{\hat{\pi}}{1-\hat{\pi}}) = -2.528 + 0.022x_1$)**:
            - $\pi(x) = 0.5$가 되는 $x = -\frac{\hat{\beta}_0}{\hat{\beta}_1} = -\frac{-2.528}{0.022} \approx 114.9 \text{km}$.
            - 이 지점에서의 순간 변화량 $\approx \frac{\hat{\beta}_1}{4} = \frac{0.022}{4} = 0.0055$ (즉, 0.55%p).
            - R의 `logitmfx()` 함수 (패키지 `mfx` 등)를 사용하면 AME 계산 가능. (예: $x_1$이 1 증가할 때 $\pi(x)$는 평균적으로 0.4%p 증가)
    2. **승산비 (Odds Ratio, OR) 해석**:
        - **승산 (Odds)**: 성공 확률을 실패 확률로 나눈 값. $\text{Odds}(x) = \frac{\pi(x)}{1-\pi(x)}$.
        - 로지스틱 회귀모형: $\log(\text{Odds}(x)) = \beta_0 + \beta_1 x$ (로그-승산을 선형 회귀).
        - **회귀계수 $\beta_1$의 의미**: $x$가 1단위 증가할 때 ($x \rightarrow x+1$), 로그-승산의 증가량.
            - $\log\left(\frac{\text{Odds}(x+1)}{\text{Odds}(x)}\right) = \beta_1$
        - **$e^{\beta_1}$의 의미 (승산비, Odds Ratio)**: $x$가 1단위 증가할 때, 승산이 몇 배로 변하는지 나타냄.
            - $OR = \frac{\text{Odds}(x+1)}{\text{Odds}(x)} = e^{\beta_1}$
        - **날다람쥐 출현 예제자료**:
            - $\hat{\beta}_1 = 0.022$
            - $e^{\hat{\beta}_1} = e^{0.022} \approx 1.022$.
            - 해석: 구획의 크기($x_1$)가 1km 증가할 때 날다람쥐가 출현할 승산은 약 1.022배 (즉, 2.2%) 증가합니다.
            - **$e^{\beta_1}$의 신뢰구간**: $\beta_1$의 Wald 신뢰구간 $(CL, CU)$을 구한 후, $(e^{CL}, e^{CU})$로 계산.
                - 예시 95% CI: $(1.009, 1.038)$. (1을 포함하지 않으므로 유의하다고 볼 수 있음)
    3. **성공확률 추정 ($\hat{\pi}(x)$)**:
        - $\hat{\pi}(x) = \frac{\exp(\hat{\beta}_0 + \hat{\beta}_1 x)}{1 + \exp(\hat{\beta}_0 + \hat{\beta}_1 x)}$
        - **$\hat{\pi}(x)$의 신뢰구간 추정**:
            1. 선형예측자 $(\hat{\beta}*0 + \hat{\beta}1 x)$의 대표본 Wald 신뢰구간 $(CL{\eta}, CU*{\eta})$를 구합니다.
                - $SE(\hat{\beta}_0 + \hat{\beta}_1 x) = \sqrt{Var(\hat{\beta}_0) + x^2 Var(\hat{\beta}_1) + 2x Cov(\hat{\beta}_0, \hat{\beta}_1)}$
            2. 변환하여 $\hat{\pi}(x)$의 신뢰구간을 구합니다: $\left(\frac{\exp(CL_{\eta})}{1+\exp(CL_{\eta})}, \frac{\exp(CU_{\eta})}{1+\exp(CU_{\eta})}\right)$.
        - **날다람쥐 출현 예제자료**:
            - $x = 150 \text{km}$에서 출현 확률 추정: $\hat{\pi}(150) \approx 0.675$.
            - 95% 신뢰구간: $(0.471, 0.829)$.

### 11. 로지스틱 회귀모형의 적합도 평가

- 이항자료, 추정된 성공확률 곡선($\hat{\pi}(x)$), 95% 신뢰구간 곡선, 그리고 각 $x$ 구간별 표본 비율(및 표준오차)을 함께 그림으로 나타내어 모형의 적합도를 시각적으로 검토합니다.
- **해석**:
    - 표본 비율들이 추정된 확률 곡선의 신뢰구간 내에 잘 위치하면 모형이 데이터에 잘 적합한다고 볼 수 있습니다.
    - 특정 구간에서 표본 비율이 신뢰구간을 벗어나면 해당 구간에서 모형의 적합도가 낮을 수 있음을 시사합니다.
    - (강의 자료의 프로그램 (1), (2)는 이러한 시각화를 위한 R 코드 예시로 보임)

### 12. 다른 이항모형: 프로빗 모형

- 로지스틱 회귀모형과 유사하게 이항 반응변수를 모델링하는 데 사용되지만, 연결함수로 **프로빗 함수**를 사용합니다.
- **프로빗 모형의 GLM 구성성분**:
    1. **반응변수 분포**: $Y \sim Bernoulli(\pi)$ 또는 $Y \sim Binomial(n, \pi)$.
    2. **선형예측자**: $\eta = \mathbf{x}'\mathbf{\beta} = \beta_0 + \beta_1 x_1 + \dots + \beta_p x_p$.
    3. **연결함수 (프로빗 함수)**: $g(\pi) = \Phi^{-1}(\pi)$.
        - $\Phi(\cdot)$는 **표준정규분포의 누적분포함수(CDF)**.
        - $\Phi^{-1}(\pi)$는 누적확률이 $\pi$가 되는 표준정규분포의 z-값 (역 CDF).
    - 모형식: $\Phi^{-1}(\pi) = \beta_0 + \beta_1 x_1 + \dots + \beta_p x_p$ 또는 $\pi = \Phi(\beta_0 + \beta_1 x_1 + \dots + \beta_p x_p)$.
- **프로빗 모형 적용 예제: 날다람쥐 출현 자료 (설명변수 $x$ 하나)**
    - 적합된 선형예측자: $\hat{\eta} = \Phi^{-1}(\hat{\pi}) = \hat{\beta}_0 + \hat{\beta}_1 x = -1.493 + 0.013x$.
    - 확률 추정식: $\hat{\pi} = \Phi(-1.493 + 0.013x)$.
    - **해석**: 로지스틱 회귀와 유사하게 해석 가능하나, 계수의 직접적인 승산비 해석은 불가. (주변 효과 등을 계산)
    - 예: 95% 이상 출현하는 구획 크기 추정
        - $\Phi(\hat{\beta}_0 + \hat{\beta}_1 x) \ge 0.95 \Rightarrow \hat{\beta}_0 + \hat{\beta}_1 x \ge \Phi^{-1}(0.95) \approx 1.645$.
        - $x \ge \frac{1.645 - \hat{\beta}_0}{\hat{\beta}_1} = \frac{1.645 - (-1.493)}{0.013} \approx 241 \text{km}$.
    - $x = 150 \text{km}$에서 출현 확률 추정: $\hat{\pi} = \Phi(-1.493 + 0.013 \times 150) \approx \Phi(0.457) \approx 0.677$.
    - 신뢰구간 추정: 로지스틱 회귀와 유사한 방식으로 선형예측자의 신뢰구간을 구한 후 $\Phi(\cdot)$ 변환. (예: (0.486, 0.830))
- **프로빗 모형과 로지스틱 회귀모형 비교**:
    - 두 모형은 S자형 곡선을 가지며, 대부분의 경우 유사한 적합 결과를 보입니다.
    - 로지스틱 분포의 꼬리가 정규분포보다 약간 더 두껍기 때문에 극단적인 값에 덜 민감할 수 있으나, 실제 분석에서 큰 차이를 보이지 않는 경우가 많습니다.
    - 로지스틱 회귀는 계수의 승산비 해석이 가능하다는 장점이 있습니다.

## V. 회귀모형 기타 주제

### 13. 일반화선형모형에서의 모수 추정

- **최대가능도추정 (Maximum Likelihood Estimation, MLE)**:
    - GLM에서는 반응변수의 확률분포(지수족)를 가정하므로, **가능도 함수(Likelihood Function)**를 구성할 수 있습니다.
    - 가능도 함수를 최대로 하는 모수($\mathbf{\beta}$)의 값을 추정치로 사용합니다.
    - 일반적으로 로그가능도 함수 $L(\mathbf{\beta})$를 사용합니다.
    - 해를 직접 구하기 어려운 경우가 많아 **수치적 최적화 알고리즘**을 사용합니다.
- **수치적 최적화 알고리즘**:
    - **표기**:
        - $L(\mathbf{\beta})$: 로그가능도 함수.
        - $\mathbf{u}(\mathbf{\beta}) = \frac{\partial L(\mathbf{\beta})}{\partial \mathbf{\beta}}$: **점수 함수 (Score Function)** (로그가능도 함수의 1차 미분).
        - $\mathbf{I}_0(\mathbf{\beta}) = -\frac{\partial^2 L(\mathbf{\beta})}{\partial \mathbf{\beta} \partial \mathbf{\beta}'}$: **관측 정보 행렬 (Observed Information Matrix)** (로그가능도 함수의 2차 미분 헤시안 행렬의 음수).
        - $\mathbf{I}(\mathbf{\beta}) = E[\mathbf{I}_0(\mathbf{\beta})]$: **피셔 정보 행렬 (Fisher Information Matrix)**.
        - $\mathbf{\beta}^{(t)}$: t번째 반복에서의 $\mathbf{\beta}$ 추정값.
    - **Newton-Raphson 방법**:
        - $\mathbf{\beta}^{(t+1)} = \mathbf{\beta}^{(t)} + [\mathbf{I}_0(\mathbf{\beta}^{(t)})]^{-1} \mathbf{u}(\mathbf{\beta}^{(t)})$
    - **Fisher 점수화 방법 (Fisher Scoring Method)**:
        - $\mathbf{\beta}^{(t+1)} = \mathbf{\beta}^{(t)} + [\mathbf{I}(\mathbf{\beta}^{(t)})]^{-1} \mathbf{u}(\mathbf{\beta}^{(t)})$
    - **특징**:
        - **정준연결(Canonical Link)을 사용하는 경우 두 방법은 일치**합니다.
        - 반복적인 계산을 통해 최대가능도 추정값($\hat{\mathbf{\beta}}_{MLE}$)에 수렴합니다.
        - $\mathbf{\beta}^{(t)}$의 변화량이 일정 수준 이하가 되면 반복을 중단하고 해당 값을 MLE로 사용합니다.
        - 이러한 반복 과정은 **반복재가중최소제곱법 (Iteratively Reweighted Least Squares, IRLS)** 알고리즘으로 구현되는 경우가 많습니다.

### 14. 일반화선형모형의 진단 방법

### 15. 일반화선형모형의 응용과 한계

- **GLM 모형진단에서 이상 징후의 대표적인 원인**:
    1. **반응변수의 확률분포 가정 오류**:
        - 예: 정규분포 가정 시 등분산성 위배 $\rightarrow$ 감마분포 가정 시도, 분산함수 모형 도입 등.
        - 예: 포아송분포 가정 시 분산 변화가 평균 변화보다 큰 경우 (과대산포, Overdispersion) $\rightarrow$ 준가능도(Quasi-likelihood) 함수를 사용하는 과대산포모형, 일반화선형혼합모형(GLMM) 적용 등.
    2. **연결함수 설정 오류**:
        - 연결함수의 적합성을 판단하는 특화된 통계적 도구는 제한적입니다.
        - 일반적으로 정준연결에서 시작하여, 가능한 다른 연결함수들을 시도해보며 모형 적합도를 비교합니다.
- **모형진단 도구**:
    1. **이탈도 (Deviance)**:
        - **정의**: $D = -2 [L(\hat{\mathbf{\mu}}; \mathbf{y}) - L(\mathbf{y}; \mathbf{y})]$
            - $L(\hat{\mathbf{\mu}}; \mathbf{y})$: 현재 설정한 모형에서의 최대로그가능도 값. (여기서 $\hat{\mathbf{\mu}} = g^{-1}(\mathbf{X}\hat{\mathbf{\beta}})$)
            - $L(\mathbf{y}; \mathbf{y})$: 포화모형(Saturated Model, 각 관측치마다 모수를 추정하여 데이터를 완벽하게 설명하는 모형)에서의 최대로그가능도 값. (로그가능도 함수가 취할 수 있는 가장 큰 값)
        - **의미**: 포화모형 대비 현재 설정한 모형의 적합도를 나타내는 측도. (작을수록 좋음)
        - **선형회귀모형 (정규분포 오차)에서의 이탈도**: $D = \frac{SSE}{\sigma^2}$. (잔차제곱합을 일반화하는 개념)
        - **이탈도를 사용한 모형적합도 검정**:
            - $H_0: \text{현재 모형이 적절하다}$ vs $H_1: \text{포화모형이 더 적절하다}$
            - 검정통계량 $D \sim \chi^2(n-p-1)$ (단, 산포모수 $\phi$가 알려져 있거나 1일 때. 추정해야 하면 F-분포 사용).
        - **이탈도를 사용한 모형 비교 검정 (Nested Models)**:
            - $M_0 \subset M_1$ (축소모형 $M_0$, 완전모형 $M_1$)
            - $H_0: M_0 \text{가 적절하다}$ vs $H_1: M_1 \text{이 더 적절하다}$
            - 검정통계량 $\Delta D = D_0 - D_1 = -2[L_0 - L_1] \sim \chi^2(df_{\text{diff}})$ ($df_{\text{diff}}$는 두 모형의 모수 개수 차이).
    2. **잔차 (Residuals)**:
        - **날 잔차 (Raw Residual)**: $r_i = y_i - \hat{\mu}_i$
        - **Pearson 잔차**: $r_{Pi} = \frac{y_i - \hat{\mu}_i}{\sqrt{Var(Y_i)}} = \frac{y_i - \hat{\mu}_i}{\sqrt{\hat{\phi}V(\hat{\mu}_i)/\omega_i}}$ (표준화된 형태)
        - **표준화 잔차 (Standardized Residual)**: $r_{Si} = \frac{y_i - \hat{\mu}_i}{\sqrt{Var(r_i)}}$ (삭제 잔차 등을 이용해 계산)
        - **이탈도 잔차 (Deviance Residual)**: 전체 이탈도 $D = \sum d_i$를 구성하는 각 관측값의 기여분. $r_{Di} = \text{sign}(y_i - \hat{\mu}_i) \sqrt{d_i}$.
            - 이탈도 잔차의 제곱합이 총 이탈도가 됨.
        - **잔차분석**:
            - 기본 그림: (예측값 $\hat{\mu}_i$ 또는 관측값 $x_i$, 잔차) 산점도.
            - 모형 가정이 올바르다면, 잔차는 근사적으로 표준정규분포를 따르는 것처럼 보여야 함 (랜덤하게 흩어져야 함).
            - **예: 날다람쥐 출현 자료 로지스틱 회귀 결과의 잔차분석**:
                - 반응변수가 0 또는 1인 이항변수이므로, 잔차 산점도가 두 줄 형태로 나타남. (일반적인 잔차 패턴 해석 어려움)
                - Q-Q plot을 통해 정규성 가정 위배 여부 확인 가능 (그림에서 오른쪽 위 상단에서 정규분포 이탈 의심).
                - (이항자료의 경우, 그룹화된 데이터에 대한 잔차나 다른 진단 방법 고려)

---