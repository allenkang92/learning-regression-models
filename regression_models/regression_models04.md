# 회귀분석 04 - 신뢰성 높은 회귀모형 개발

---

## 목차

**I. 고급 회귀모형 유형**
1. [다항회귀모형의 기본 원리](#1-다항회귀모형-polynomial-regression-model)
2. [다항회귀모형의 활용](#2-다항회귀모형의-활용)
3. [다항회귀의 주의사항](#3-다항회귀의-주의사항)

**II. 더미변수와 교호작용**
1. [더미변수의 기본 개념](#4-더미변수의-기본-개념)
2. [교호작용의 의미와 해석](#5-교호작용의-의미와-해석)
3. [회귀모형에서 교호작용 모형화](#6-회귀모형에서-교호작용-모형화)

**III. 회귀모형 평가와 겜정**
1. [모형 적합도 평가 기준](#7-모형-적합도-평가-기준)
2. [예측 정확도 분석](#8-예측-정확도-분석)
3. [모형 선택과 개선전략](#9-모형-선택과-개선전략)

---

## I. 고급 회귀모형 유형

### 1. 다항회귀모형의 기본 원리

- **다항회귀모형의 개념**:
    - 단순회귀모형: 설명변수(X)와 종속변수(Y) 간의 **직선적인 관계**를 가정.
    - **다항회귀모형**: 설명변수(X)와 종속변수(Y) 간의 **곡선적인 관계**를 모델링하기 위해 설명변수의 거듭제곱 항($X^2, X^3, \dots$)을 모형에 포함시킵니다.
    - 비록 $X$의 고차항이 포함되지만, 회귀계수($\beta$)에 대해서는 여전히 선형이므로 **선형회귀모형의 일종**으로 취급됩니다.
- **설명변수가 하나인 경우 (예: 이차다항회귀모형)**:
    - $Y_i = \beta_0 + \beta_1 X_i + \beta_2 X_i^2 + \epsilon_i$
    - **R 적합**: `lm(Y ~ X1 + I(X1^2), data=test)`
        - `I(X1^2)`: `X1`의 제곱항을 모형에 포함시키라는 의미. `I()` 함수는 괄호 안의 연산을 산술적으로 먼저 수행하도록 합니다.
- **다항회귀모형의 차수 결정**:
    - 산점도, 잔차그림 등을 통해 곡선 관계의 형태를 파악합니다.
    - 통계적 유의성(t-검정, F-검정), 모형 선택 기준(AIC, BIC) 등을 고려하여 적절한 차수를 결정합니다.
    - 너무 높은 차수는 과적합(Overfitting)을 유발할 수 있으므로 주의해야 합니다.
- **다항회귀에서의 다중공선성 문제**:
    - $X, X^2, X^3, \dots$ 항들은 서로 높은 상관관계를 가질 가능성이 큽니다 (구조적 다중공선성).
    - **해결 방법: 중심화 (Centering)**
        - 독립변수 $X$를 그 평균 $\bar{X}$로 중심화하여 $X' = X - \bar{X}$를 사용합니다.
        - 즉, 모형에 $(X-\bar{X}), (X-\bar{X})^2, \dots$ 항들을 포함시킵니다.
        - 중심화는 다항 항들 간의 상관관계를 줄여 다중공선성 문제를 완화하고, 회귀계수 추정치의 안정성을 높이는 데 도움이 됩니다. (회귀계수의 해석은 원래 변수 기준으로 다시 변환해야 할 수 있음)
- **R 사용: 교통범죄 자료 예제 (이차다항회귀)**:
    - 데이터: `tcrime.csv` (year, tcratio: 교통범죄율, motor: 자동차등록대수)
    - `plot(motor, tcratio, pch=19)`: 산점도에서 곡선 관계 확인.
    - **원래 변수 사용**: `tcrime.lm = lm(tcratio ~ motor + I(motor^2), data=tcrime)`
        - `summary(tcrime.lm)` 결과에서 `motor`와 `I(motor^2)` 항 모두 유의하게 나옴.
    - **중심화된 변수 사용**:
        - `zmotor = motor - mean(motor)`
        - `ztcrime.lm = lm(tcratio ~ zmotor + I(zmotor^2), data=tcrime)`
        - `summary(ztcrime.lm)` 결과:
            - 회귀계수 추정치는 달라지지만, 모형의 설명력($R^2$)이나 F-통계량 등은 동일하게 나옵니다.
            - **VIF 값 비교**:
                - `VIF(lm(motor ~ I(motor^2), data=tcrime))` 결과: `10.32` (다중공선성 의심)
                - `VIF(lm(zmotor ~ I(zmotor^2), data=tcrime))` 결과: `3.78` (다중공선성 완화)
- **R 사용: 마라톤 자료 예제 (삼차다항회귀)**:
    - 데이터: `maraton.csv` (sect: 5km 구간, m1990: 1990년 평균속도)
    - `plot(maraton$sect, maraton$m1990, pch=19)`: 산점도에서 복잡한 곡선 관계 확인.
    - **원래 변수 사용**: `maraton.lm = lm(m1990 ~ sect + I(sect^2) + I(sect^3), data=maraton)`
        - `summary(maraton.lm)` 결과에서 모든 항이 유의하게 나옴.
    - **중심화된 변수 사용**:
        - `zsect = maraton$sect - mean(maraton$sect)`
        - `zmaraton.lm = lm(m1990 ~ zsect + I(zsect^2) + I(zsect^3), data=maraton)`
        - `summary(zmaraton.lm)` 결과에서 회귀계수 추정치 변화 확인.
        - **VIF 값 비교**:
            - 원래 변수 사용 시: `sect`의 VIF `208.78`, `I(sect^2)`의 VIF `1116.59`, `I(sect^3)`의 VIF `399.01` (심각한 다중공선성)
            - 중심화 변수 사용 시: `zsect`의 VIF `7.05`, `I(zsect^2)`의 VIF `1.00`, `I(zsect^3)`의 VIF `7.05` (다중공선성 크게 완화)
- **설명변수가 두 개인 경우 (예: 이차다항회귀모형)**:
    - $Y_i = \beta_0 + \beta_1 X_{i1} + \beta_2 X_{i2} + \beta_3 X_{i1}^2 + \beta_4 X_{i2}^2 + \beta_5 X_{i1}X_{i2} + \epsilon_i$
    - **교호작용항 (Interaction Term, $X_{i1}X_{i2}$)**: 두 설명변수가 서로에게 미치는 영향을 고려하기 위해 포함.
    - **R 적합**: `lm(Y ~ X1 + X2 + I(X1^2) + I(X2^2) + X1:X2, data=test)`
        - `X1:X2` 또는 `X1*X2` (R에서는 가 주효과와 교호작용항을 모두 포함)로 교호작용항을 나타냅니다.

### 2. 다항회귀모형의 활용

### 3. 다항회귀의 주의사항

## II. 더미변수와 교호작용

### 4. 더미변수의 기본 개념

- **가변수 (Dummy Variable) 또는 지시변수 (Indicator Variable)**:
    - 회귀모형은 기본적으로 설명변수와 반응변수가 모두 **양적자료(Quantitative Data)**일 때 사용됩니다.
    - 모형에 **질적자료(Qualitative Data, 범주형 변수)**를 포함시키기 위해 사용하는 변환된 변수입니다.
    - 일반적으로 특정 범주(특성)에 해당하면 **1**, 그렇지 않으면 **0**의 값을 가집니다.
    - **주의**: 반응변수가 가변수인 경우(예: 로지스틱 회귀), 일반 선형회귀모형의 가정(정규성, 등분산성 등)이 위배될 수 있어 다른 모형을 사용해야 합니다. (본 강의에서는 설명변수가 가변수인 경우를 다룸)
- **가변수 설정 방법**:
    - 범주가 **k개**인 질적변수의 경우, **k-1개**의 가변수를 생성하여 모형에 포함시킵니다.
    - 하나의 범주를 **기준범주(Reference Category)**로 설정하고, 나머지 범주들에 대해 가변수를 만듭니다.
    - **예**: 성별 (남, 여) → "여성" 가변수 D 생성 (여성이면 1, 남성이면 0). 여기서 "남성"이 기준범주.
- **가변수 회귀모형의 해석**:
    - **설명변수가 하나의 가변수 D만 있는 경우**:
        - $Y_i = \beta_0 + \beta_1 D_i + \epsilon_i$
        - $D_i=0$ (기준범주): $E(Y|D=0) = \beta_0$ (기준범주의 평균 Y값)
        - $D_i=1$: $E(Y|D=1) = \beta_0 + \beta_1$ (해당 범주의 평균 Y값)
        - $\beta_1$: 두 범주 간의 평균 Y값 차이.
    - **양적 설명변수 X와 하나의 가변수 D가 있는 경우 (교호작용 없음)**:
        - $Y_i = \beta_0 + \beta_1 X_i + \beta_2 D_i + \epsilon_i$
        - $D_i=0$ (기준범주): $\hat{Y} = \hat{\beta}_0 + \hat{\beta}_1 X_i$ (기준범주에 대한 회귀선)
        - $D_i=1$: $\hat{Y} = (\hat{\beta}_0 + \hat{\beta}_2) + \hat{\beta}_1 X_i$ (해당 범주에 대한 회귀선)
        - 두 회귀선은 **기울기는 같고($\hat{\beta}_1$), 절편만 다릅니다($\hat{\beta}_2$만큼 차이)**. 즉, 평행한 두 직선.
- **R 사용: 비누공장 자료 예제 (생산라인별 생산량)**:
    - 데이터: `soup.csv` (Y: 생산량, X: 원료량, D: 생산라인 구분 - 0 또는 1)
    - 가변수 D를 factor형으로 변환: `soup$D = factor(soup$D, levels=c(0,1), label=c("Line0", "Line1"))`
    - **산점도 (생산라인별 구분)**:
        
        ```
        plot(soup$X, soup$Y, type="n")
        points(soup$X[soup$D=="Line1"], soup$Y[soup$D=="Line1"], pch=17, col="BLUE")
        points(soup$X[soup$D=="Line0"], soup$Y[soup$D=="Line0"], pch=19, col="RED")
        legend("bottomright", legend=levels(soup$D), pch=c(19,17), col=c("RED","BLUE"))
        
        ```
        
    - **회귀모형 적합 (교호작용 없음)**: `soup.lm = lm(Y ~ X + D, data=soup)`
        - `summary(soup.lm)` 결과:
            
            
            | Coefficients | Estimate | Std. Error | t value | Pr(>|t|) |
            | --- | --- | --- | --- | --- |
            | (Intercept) | 27.28179 | 15.40701 | 1.771 | 0.0893 . |
            | X | 1.23074 | 0.06555 | 18.775 | 7.48e-16 \*\*\* |
            | DLine1 | 53.12920 | 8.21003 | 6.471 | 1.08e-06 \*\*\* |
        - **해석**:
            - Line0 (기준범주, D=0): $\hat{Y} = 27.28 + 1.23 X$
            - Line1 (D=1): $\hat{Y} = (27.28 + 53.13) + 1.23 X = 80.41 + 1.23 X$
            - DLine1의 계수(53.13)는 Line0에 비해 Line1의 생산량이 평균적으로 53.13만큼 더 높다는 것을 의미 (동일한 원료량 X에서).
        - **회귀선 그리기**:
            - `abline(27.28179, 1.23074, lty=2, col="RED")` (Line0)
            - `abline(27.28179+53.1292, 1.23074, lty=2, col="BLUE")` (Line1)
- **가변수 회귀모형: 교호작용 포함**:
    - 양적 설명변수 X와 가변수 D 사이에 **교호작용(Interaction)**이 있다고 가정하면, 각 범주에 따라 X가 Y에 미치는 영향(기울기)이 다를 수 있습니다.
    - $Y_i = \beta_0 + \beta_1 X_i + \beta_2 D_i + \beta_3 (X_i D_i) + \epsilon_i$
    - $D_i=0$ (기준범주): $\hat{Y} = \hat{\beta}_0 + \hat{\beta}_1 X_i$
    - $D_i=1$: $\hat{Y} = (\hat{\beta}_0 + \hat{\beta}_2) + (\hat{\beta}_1 + \hat{\beta}_3) X_i$
    - 두 회귀선은 **절편도 다르고($\hat{\beta}_2$만큼 차이), 기울기도 다릅니다($\hat{\beta}_3$만큼 차이)**.
    - **R 사용: 비누공장 자료 예제 (교호작용 포함)**:
        - `soup2.lm = lm(Y ~ X + D + X:D, data=soup)` (또는 `Y ~ X*D`)
        - `summary(soup2.lm)` 결과:
            
            
            | Coefficients | Estimate | Std. Error | t value | Pr(>|t|) |
            | --- | --- | --- | --- | --- |
            | (Intercept) | 7.57446 | 20.86970 | 0.363 | 0.71996 |
            | X | 1.32205 | 0.09262 | 14.273 | 6.45e-13 \*\*\* |
            | DLine1 | 90.39086 | 28.34573 | 3.189 | 0.00409 \*\* |
            | X:DLine1 | -0.17666 | 0.12884 | -1.371 | 0.18355 |
        - **해석**: 교호작용항 `X:DLine1`의 p-값(0.18355)이 유의수준 0.05에서 유의하지 않으므로, 이 자료에서는 교호작용을 고려하지 않은 모형(기울기가 같은 모형)이 더 적절하다고 판단할 수 있습니다.
- **가변수의 범주가 3개 이상인 경우**:
    - 범주가 k개이면, (k-1)개의 가변수를 생성합니다.
    - **예**: 지역 (A, B, C)

### 5. 교호작용의 의미와 해석

- **교호작용의 정의**:
    - 두 변수가 종속변수에 미치는 효과가 서로 도의적(독립적)이지 않고 서로 영향을 미치는 현상입니다.
    - 하나의 변수가 종속변수에 미치는 효과가 다른 변수의 값에 따라 달라집니다.

### 6. 회귀모형에서 교호작용 모형화

- **교호항 포함 방법**:
    - 두 변수의 곱(X×Z)을 모형에 추가하여 교호작용을 모형화합니다.
    - R에서는 `X*Z` 또는 `X:Z` 구문을 사용합니다.

## III. 회귀모형 평가와 겜정

### 7. 모형 적합도 평가 기준

- **모형 선택 기준**:
    - 결정계수(R²)와 조정된 결정계수(Adjusted R²)
    - AIC(Akaike Information Criterion)와 BIC(Bayesian Information Criterion)
    - 교차검증과 예측 오차

### 8. 예측 정확도 분석

- **예측 오차 측정**:
    - 평균제곱오차(MSE)와 제곱근(RMSE)
    - 평균절대오차비율(MAPE)

### 9. 모형 선택과 개선전략

- **모형 개선 방법**:
    - 변수 변환과 트리밍
    - 모형 단순화와 복잡성 가중
    - 교차검증을 통한 모형 평가
        - $D_1 = 1$ (지역 B), $0$ (그 외)
        - $D_2 = 1$ (지역 C), $0$ (그 외)
        - (지역 A가 기준범주: $D_1=0, D_2=0$)
    - 모형: $Y_i = \beta_0 + \beta_1 X_i + \beta_2 D_{i1} + \beta_3 D_{i2} + \epsilon_i$
        - 지역 A (기준): $E(Y) = \beta_0 + \beta_1 X_i$
        - 지역 B: $E(Y) = (\beta_0 + \beta_2) + \beta_1 X_i$
        - 지역 C: $E(Y) = (\beta_0 + \beta_3) + \beta_1 X_i$

---